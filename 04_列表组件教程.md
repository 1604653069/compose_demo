# Jetpack Compose 列表组件完全指南

## 前言

在移动应用开发中，列表组件是展示大量数据的核心组件。Jetpack Compose 提供了强大且高效的列表组件，包括 LazyColumn、LazyRow、LazyVerticalGrid 等，它们采用懒加载机制，能够高效处理大量数据。本文将详细介绍 Compose 中的列表组件，帮助你构建性能优异的列表界面。

---

## 1. LazyColumn - 垂直列表

LazyColumn 是最常用的垂直列表组件，它只会创建和渲染当前可见的列表项，极大提升了性能。

### 1.1 基础 LazyColumn

```kotlin
@Composable
fun BasicLazyColumnExample() {
    val items = (1..20).map { "列表项目 $it" }

    LazyColumn(
        modifier = Modifier.fillMaxSize(),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        items(items) { item ->
            Card(
                modifier = Modifier.fillMaxWidth(),
                elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
            ) {
                Text(
                    text = item,
                    modifier = Modifier.padding(16.dp),
                    style = MaterialTheme.typography.bodyLarge
                )
            }
        }
    }
}
```

### 1.2 带索引的列表项

```kotlin
@Composable
fun IndexedLazyColumnExample() {
    val items = (1..50).map { "项目 $it" }

    LazyColumn(
        modifier = Modifier.fillMaxSize(),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        // 使用 itemsIndexed 获取索引
        itemsIndexed(items) { index, item ->
            ListItem(
                headlineContent = { Text(item) },
                supportingContent = { Text("索引: $index") },
                leadingContent = {
                    Surface(
                        modifier = Modifier.size(40.dp),
                        color = MaterialTheme.colorScheme.primaryContainer,
                        shape = CircleShape
                    ) {
                        Box(contentAlignment = Alignment.Center) {
                            Text(
                                text = "${index + 1}",
                                style = MaterialTheme.typography.titleSmall,
                                color = MaterialTheme.colorScheme.onPrimaryContainer
                            )
                        }
                    }
                },
                trailingContent = {
                    Icon(
                        imageVector = Icons.Default.KeyboardArrowRight,
                        contentDescription = "详情"
                    )
                },
                colors = ListItemDefaults.colors(
                    containerColor = MaterialTheme.colorScheme.surface
                ),
                modifier = Modifier.clickable { /* 处理点击 */ }
            )
        }
    }
}
```

### 1.3 混合内容列表

```kotlin
@Composable
fun MixedContentLazyColumnExample() {
    val data = generateMixedListData()

    LazyColumn(
        modifier = Modifier.fillMaxSize(),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        // 头部
        item {
            Card(
                modifier = Modifier.fillMaxWidth(),
                colors = CardDefaults.cardColors(
                    containerColor = MaterialTheme.colorScheme.primaryContainer
                )
            ) {
                Column(
                    modifier = Modifier.padding(16.dp),
                    horizontalAlignment = Alignment.CenterHorizontally
                ) {
                    Icon(
                        imageVector = Icons.Default.List,
                        contentDescription = null,
                        modifier = Modifier.size(48.dp),
                        tint = MaterialTheme.colorScheme.onPrimaryContainer
                    )
                    Spacer(modifier = Modifier.height(8.dp))
                    Text(
                        text = "综合列表",
                        style = MaterialTheme.typography.headlineSmall,
                        color = MaterialTheme.colorScheme.onPrimaryContainer
                    )
                    Text(
                        text = "包含不同类型的内容",
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.onPrimaryContainer
                    )
                }
            }
        }

        // 分组标题
        item {
            Text(
                text = "用户列表",
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                modifier = Modifier.padding(vertical = 8.dp)
            )
        }

        // 用户列表
        items(data.users) { user ->
            UserListItem(user = user)
        }

        // 分组标题
        item {
            Text(
                text = "产品列表",
                style = MaterialTheme.typography.titleLarge,
                fontWeight = FontWeight.Bold,
                modifier = Modifier.padding(vertical = 8.dp)
            )
        }

        // 产品列表
        items(data.products) { product ->
            ProductListItem(product = product)
        }

        // 底部
        item {
            Card(
                modifier = Modifier.fillMaxWidth(),
                colors = CardDefaults.cardColors(
                    containerColor = MaterialTheme.colorScheme.surfaceVariant
                )
            ) {
                Text(
                    text = "列表结束 - 共 ${data.users.size + data.products.size} 项",
                    modifier = Modifier.padding(16.dp),
                    style = MaterialTheme.typography.bodyMedium,
                    textAlign = TextAlign.Center
                )
            }
        }
    }
}

@OptIn(ExperimentalMaterial3Api::class)
@Composable
private fun UserListItem(user: User) {
    var expanded by remember { mutableStateOf(false) }

    Card(
        modifier = Modifier
            .fillMaxWidth()
            .clickable { expanded = !expanded },
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Row(
                verticalAlignment = Alignment.CenterVertically
            ) {
                Surface(
                    modifier = Modifier.size(48.dp),
                    color = MaterialTheme.colorScheme.primaryContainer,
                    shape = MaterialTheme.shapes.medium
                ) {
                    Box(contentAlignment = Alignment.Center) {
                        Text(
                            text = user.name.first().toString(),
                            style = MaterialTheme.typography.titleLarge,
                            color = MaterialTheme.colorScheme.onPrimaryContainer
                        )
                    }
                }
                Spacer(modifier = Modifier.width(12.dp))
                Column(modifier = Modifier.weight(1f)) {
                    Text(
                        text = user.name,
                        style = MaterialTheme.typography.titleMedium
                    )
                    Text(
                        text = user.role,
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }
                Icon(
                    imageVector = if (expanded) Icons.Default.ExpandLess else Icons.Default.ExpandMore,
                    contentDescription = if (expanded) "收起" else "展开"
                )
            }

            if (expanded) {
                Spacer(modifier = Modifier.height(12.dp))
                HorizontalDivider()
                Spacer(modifier = Modifier.height(12.dp))
                Text(
                    text = user.description,
                    style = MaterialTheme.typography.bodyMedium
                )
                Row(
                    modifier = Modifier.padding(top = 8.dp),
                    horizontalArrangement = Arrangement.spacedBy(16.dp)
                ) {
                    Row(verticalAlignment = Alignment.CenterVertically) {
                        Icon(
                            imageVector = Icons.Default.Email,
                            contentDescription = null,
                            modifier = Modifier.size(16.dp)
                        )
                        Spacer(modifier = Modifier.width(4.dp))
                        Text(
                            text = user.email,
                            style = MaterialTheme.typography.bodySmall
                        )
                    }
                    Row(verticalAlignment = Alignment.CenterVertically) {
                        Icon(
                            imageVector = Icons.Default.Phone,
                            contentDescription = null,
                            modifier = Modifier.size(16.dp)
                        )
                        Spacer(modifier = Modifier.width(4.dp))
                        Text(
                            text = user.phone,
                            style = MaterialTheme.typography.bodySmall
                        )
                    }
                }
            }
        }
    }
}

@Composable
private fun ProductListItem(product: Product) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .height(120.dp),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Row(
            modifier = Modifier.padding(12.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            Surface(
                modifier = Modifier.size(80.dp),
                color = MaterialTheme.colorScheme.surfaceVariant,
                shape = MaterialTheme.shapes.small
            ) {
                Box(contentAlignment = Alignment.Center) {
                    Icon(
                        imageVector = product.icon,
                        contentDescription = null,
                        modifier = Modifier.size(32.dp),
                        tint = MaterialTheme.colorScheme.primary
                    )
                }
            }
            Spacer(modifier = Modifier.width(12.dp))
            Column(modifier = Modifier.weight(1f)) {
                Text(
                    text = product.name,
                    style = MaterialTheme.typography.titleMedium
                )
                Text(
                    text = product.description,
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant,
                    maxLines = 2
                )
                Spacer(modifier = Modifier.weight(1f))
                Text(
                    text = "¥${product.price}",
                    style = MaterialTheme.typography.titleMedium,
                    color = MaterialTheme.colorScheme.primary
                )
            }
        }
    }
}
```

---

## 2. LazyRow - 水平列表

LazyRow 适用于水平滚动的内容，如图片库、分类标签等。

### 2.1 基础 LazyRow

```kotlin
@Composable
fun BasicLazyRowExample() {
    val items = (1..10).map { "项目 $it" }

    LazyRow(
        horizontalArrangement = Arrangement.spacedBy(8.dp),
        contentPadding = PaddingValues(horizontal = 16.dp)
    ) {
        items(items) { item ->
            Card(
                modifier = Modifier
                    .width(120.dp)
                    .height(80.dp),
                elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)
            ) {
                Box(
                    modifier = Modifier.fillMaxSize(),
                    contentAlignment = Alignment.Center
                ) {
                    Text(
                        text = item,
                        style = MaterialTheme.typography.bodyMedium
                    )
                }
            }
        }
    }
}
```

### 2.2 分类标签列表

```kotlin
@Composable
fun CategoryTagsExample() {
    val categories = listOf(
        "全部", "编程", "设计", "摄影", "音乐", "电影", "游戏", "美食", "旅行", "运动"
    )

    var selectedCategory by remember { mutableStateOf("全部") }

    Column(
        modifier = Modifier.fillMaxWidth()
    ) {
        Text(
            text = "选择分类",
            style = MaterialTheme.typography.titleMedium,
            fontWeight = FontWeight.Bold,
            modifier = Modifier.padding(16.dp)
        )

        LazyRow(
            horizontalArrangement = Arrangement.spacedBy(8.dp),
            contentPadding = PaddingValues(horizontal = 16.dp)
        ) {
            items(categories) { category ->
                FilterChip(
                    onClick = {
                        selectedCategory = category
                    },
                    label = { Text(category) },
                    selected = category == selectedCategory
                )
            }
        }

        Spacer(modifier = Modifier.height(16.dp))

        Text(
            text = "当前选择: $selectedCategory",
            style = MaterialTheme.typography.bodyMedium,
            color = MaterialTheme.colorScheme.primary,
            modifier = Modifier.padding(horizontal = 16.dp)
        )
    }
}
```

### 2.3 图片库列表

```kotlin
@Composable
fun ImageGalleryExample() {
    val imageItems = (1..20).map { index ->
        ImageItem(
            id = index,
            title = "图片 $index",
            description = "这是第 $index 张图片的描述"
        )
    }

    Column(
        modifier = Modifier.fillMaxSize()
    ) {
        Text(
            text = "图片库",
            style = MaterialTheme.typography.titleLarge,
            fontWeight = FontWeight.Bold,
            modifier = Modifier.padding(16.dp)
        )

        LazyRow(
            horizontalArrangement = Arrangement.spacedBy(12.dp),
            contentPadding = PaddingValues(horizontal = 16.dp)
        ) {
            items(imageItems) { imageItem ->
                ImageGalleryItem(imageItem = imageItem)
            }
        }
    }
}

@Composable
private fun ImageGalleryItem(imageItem: ImageItem) {
    Card(
        modifier = Modifier
            .width(160.dp)
            .height(200.dp)
            .clickable { /* 查看大图 */ },
        elevation = CardDefaults.cardElevation(defaultElevation = 6.dp)
    ) {
        Column {
            // 图片占位符
            Surface(
                modifier = Modifier
                    .fillMaxWidth()
                    .height(120.dp),
                color = MaterialTheme.colorScheme.surfaceVariant
            ) {
                Box(contentAlignment = Alignment.Center) {
                    Icon(
                        imageVector = Icons.Default.Image,
                        contentDescription = null,
                        modifier = Modifier.size(48.dp),
                        tint = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }
            }

            // 图片信息
            Column(
                modifier = Modifier.padding(12.dp)
            ) {
                Text(
                    text = imageItem.title,
                    style = MaterialTheme.typography.titleSmall,
                    maxLines = 1
                )
                Text(
                    text = imageItem.description,
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant,
                    maxLines = 2
                )
            }
        }
    }
}
```

---

## 3. LazyVerticalGrid - 网格列表

LazyVerticalGrid 可以创建网格布局，适合展示图片库、产品列表等网格状内容。

### 3.1 自适应网格

```kotlin
@Composable
fun AdaptiveGridExample() {
    val items = generateGridItems()

    LazyVerticalGrid(
        columns = GridCells.Adaptive(minSize = 120.dp),
        contentPadding = PaddingValues(16.dp),
        horizontalArrangement = Arrangement.spacedBy(8.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        items(items) { item ->
            GridItem(item = item)
        }
    }
}

@Composable
private fun GridItem(item: GridItem) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .height(120.dp)
            .clickable { /* 处理点击 */ },
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Column(
            modifier = Modifier.padding(12.dp),
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.Center
        ) {
            Surface(
                modifier = Modifier.size(48.dp),
                color = MaterialTheme.colorScheme.primaryContainer,
                shape = CircleShape
            ) {
                Box(contentAlignment = Alignment.Center) {
                    Icon(
                        imageVector = item.icon,
                        contentDescription = null,
                        modifier = Modifier.size(24.dp),
                        tint = MaterialTheme.colorScheme.primary
                    )
                }
            }
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                text = item.title,
                style = MaterialTheme.typography.titleSmall,
                textAlign = TextAlign.Center
            )
        }
    }
}
```

### 3.2 固定列数网格

```kotlin
@Composable
fun FixedGridExample() {
    val products = generateProductList()

    LazyVerticalGrid(
        columns = GridCells.Fixed(2),
        contentPadding = PaddingValues(16.dp),
        horizontalArrangement = Arrangement.spacedBy(8.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        items(products) { product ->
            ProductGridItem(product = product)
        }
    }
}

@Composable
private fun ProductGridItem(product: Product) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .height(200.dp)
            .clickable { /* 查看详情 */ },
        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)
    ) {
        Column(
            modifier = Modifier.padding(12.dp)
        ) {
            // 产品图标
            Surface(
                modifier = Modifier
                    .fillMaxWidth()
                    .height(80.dp),
                color = MaterialTheme.colorScheme.surfaceVariant,
                shape = MaterialTheme.shapes.small
            ) {
                Box(contentAlignment = Alignment.Center) {
                    Icon(
                        imageVector = product.icon,
                        contentDescription = null,
                        modifier = Modifier.size(36.dp),
                        tint = MaterialTheme.colorScheme.primary
                    )
                }
            }

            Spacer(modifier = Modifier.height(8.dp))

            // 产品名称
            Text(
                text = product.name,
                style = MaterialTheme.typography.titleSmall,
                maxLines = 1
            )

            // 产品描述
            Text(
                text = product.description,
                style = MaterialTheme.typography.bodySmall,
                color = MaterialTheme.colorScheme.onSurfaceVariant,
                maxLines = 2,
                modifier = Modifier.padding(vertical = 4.dp)
            )

            Spacer(modifier = Modifier.weight(1f))

            // 价格
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text(
                    text = "¥${product.price}",
                    style = MaterialTheme.typography.titleMedium,
                    color = MaterialTheme.colorScheme.primary
                )
                IconButton(
                    onClick = { /* 添加到购物车 */ },
                    modifier = Modifier.size(32.dp)
                ) {
                    Icon(
                        imageVector = Icons.Default.Add,
                        contentDescription = "添加",
                        modifier = Modifier.size(20.dp)
                    )
                }
            }
        }
    }
}
```

### 3.3 不同尺寸的网格项目

```kotlin
@Composable
fun VariableGridExample() {
    val items = generateVariableGridItems()

    LazyVerticalGrid(
        columns = GridCells.Adaptive(minSize = 150.dp),
        contentPadding = PaddingValues(16.dp),
        horizontalArrangement = Arrangement.spacedBy(8.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        items(items) { item ->
            when (item.type) {
                GridItemType.SMALL -> SmallGridItem(item)
                GridItemType.MEDIUM -> MediumGridItem(item)
                GridItemType.LARGE -> LargeGridItem(item)
            }
        }
    }
}

@Composable
private fun SmallGridItem(item: VariableGridItem) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .height(100.dp)
            .clickable { /* 处理点击 */ },
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Box(
            modifier = Modifier.fillMaxSize(),
            contentAlignment = Alignment.Center
        ) {
            Column(
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                Icon(
                    imageVector = item.icon,
                    contentDescription = null,
                    modifier = Modifier.size(24.dp)
                )
                Spacer(modifier = Modifier.height(4.dp))
                Text(
                    text = item.title,
                    style = MaterialTheme.typography.bodySmall,
                    textAlign = TextAlign.Center
                )
            }
        }
    }
}

@Composable
private fun MediumGridItem(item: VariableGridItem) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .height(150.dp)
            .clickable { /* 处理点击 */ },
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Column(
            modifier = Modifier.padding(12.dp),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Surface(
                modifier = Modifier.size(48.dp),
                color = MaterialTheme.colorScheme.primaryContainer,
                shape = CircleShape
            ) {
                Box(contentAlignment = Alignment.Center) {
                    Icon(
                        imageVector = item.icon,
                        contentDescription = null,
                        modifier = Modifier.size(24.dp),
                        tint = MaterialTheme.colorScheme.primary
                    )
                }
            }
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                text = item.title,
                style = MaterialTheme.typography.titleSmall,
                textAlign = TextAlign.Center
            )
            Text(
                text = item.description,
                style = MaterialTheme.typography.bodySmall,
                color = MaterialTheme.colorScheme.onSurfaceVariant,
                textAlign = TextAlign.Center
            )
        }
    }
}

@Composable
private fun LargeGridItem(item: VariableGridItem) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .height(200.dp)
            .clickable { /* 处理点击 */ },
        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Surface(
                modifier = Modifier
                    .size(64.dp)
                    .align(Alignment.CenterHorizontally),
                color = MaterialTheme.colorScheme.primaryContainer,
                shape = CircleShape
            ) {
                Box(contentAlignment = Alignment.Center) {
                    Icon(
                        imageVector = item.icon,
                        contentDescription = null,
                        modifier = Modifier.size(32.dp),
                        tint = MaterialTheme.colorScheme.primary
                    )
                }
            }
            Spacer(modifier = Modifier.height(12.dp))
            Text(
                text = item.title,
                style = MaterialTheme.typography.titleMedium,
                textAlign = TextAlign.Center,
                modifier = Modifier.fillMaxWidth()
            )
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                text = item.description,
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant,
                textAlign = TextAlign.Center,
                modifier = Modifier.fillMaxWidth()
            )
        }
    }
}
```

---

## 4. 列表状态管理

### 4.1 列表滚动状态

```kotlin
@Composable
fun ScrollStateExample() {
    val items = (1..50).map { "项目 $it" }
    val listState = rememberLazyListState()
    var firstVisibleIndex by remember { mutableIntStateOf(0) }
    var isScrolling by remember { mutableStateOf(false) }

    // 监听滚动状态
    LaunchedEffect(listState.firstVisibleItemIndex) {
        firstVisibleIndex = listState.firstVisibleItemIndex
    }

    LaunchedEffect(listState.isScrollInProgress) {
        isScrolling = listState.isScrollInProgress
    }

    Column {
        // 状态信息栏
        Card(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp)
        ) {
            Row(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(16.dp),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Column {
                    Text(
                        text = "当前索引: $firstVisibleIndex",
                        style = MaterialTheme.typography.bodyMedium
                    )
                    Text(
                        text = "滚动状态: ${if (isScrolling) "滚动中" else "静止"}",
                        style = MaterialTheme.typography.bodySmall,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }

                // 滚动控制按钮
                Row(
                    horizontalArrangement = Arrangement.spacedBy(8.dp)
                ) {
                    IconButton(
                        onClick = {
                            coroutineScope.launch {
                                listState.animateScrollToItem(0)
                            }
                        }
                    ) {
                        Icon(
                            imageVector = Icons.Default.KeyboardArrowUp,
                            contentDescription = "滚动到顶部"
                        )
                    }
                    IconButton(
                        onClick = {
                            coroutineScope.launch {
                                listState.animateScrollToItem(items.size - 1)
                            }
                        }
                    ) {
                        Icon(
                            imageVector = Icons.Default.KeyboardArrowDown,
                            contentDescription = "滚动到底部"
                        )
                    }
                }
            }
        }

        // 列表
        LazyColumn(
            state = listState,
            modifier = Modifier.weight(1f),
            contentPadding = PaddingValues(16.dp),
            verticalArrangement = Arrangement.spacedBy(8.dp)
        ) {
            itemsIndexed(items) { index, item ->
                ListItem(
                    headlineContent = { Text(item) },
                    supportingContent = { Text("索引: $index") },
                    leadingContent = {
                        Surface(
                            modifier = Modifier.size(40.dp),
                            color = if (index == firstVisibleIndex)
                                MaterialTheme.colorScheme.primary
                            else MaterialTheme.colorScheme.surfaceVariant,
                            shape = CircleShape
                        ) {
                            Box(contentAlignment = Alignment.Center) {
                                Text(
                                    text = "${index + 1}",
                                    style = MaterialTheme.typography.titleSmall,
                                    color = if (index == firstVisibleIndex)
                                        MaterialTheme.colorScheme.onPrimary
                                    else MaterialTheme.colorScheme.onSurfaceVariant
                                )
                            }
                        }
                    }
                )
            }
        }
    }
}
```

### 4.2 搜索和过滤

```kotlin
@Composable
fun SearchableListExample() {
    val allItems = generateSearchableItems()
    var searchQuery by remember { mutableStateOf("") }
    var selectedCategory by remember { mutableStateOf("全部") }

    // 过滤后的列表
    val filteredItems = remember(allItems, searchQuery, selectedCategory) {
        allItems.filter { item ->
            val matchesSearch = searchQuery.isEmpty() ||
                item.title.contains(searchQuery, ignoreCase = true) ||
                item.description.contains(searchQuery, ignoreCase = true)
            val matchesCategory = selectedCategory == "全部" || item.category == selectedCategory
            matchesSearch && matchesCategory
        }
    }

    Column(
        modifier = Modifier.fillMaxSize()
    ) {
        // 搜索框
        Card(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp)
        ) {
            Column(
                modifier = Modifier.padding(16.dp)
            ) {
                OutlinedTextField(
                    value = searchQuery,
                    onValueChange = { searchQuery = it },
                    label = { Text("搜索") },
                    placeholder = { Text("输入关键词搜索...") },
                    leadingIcon = {
                        Icon(
                            imageVector = Icons.Default.Search,
                            contentDescription = null
                        )
                    },
                    trailingIcon = {
                        if (searchQuery.isNotEmpty()) {
                            IconButton(onClick = { searchQuery = "" }) {
                                Icon(
                                    imageVector = Icons.Default.Clear,
                                    contentDescription = "清除"
                                )
                            }
                        }
                    },
                    modifier = Modifier.fillMaxWidth()
                )

                Spacer(modifier = Modifier.height(12.dp))

                // 分类过滤
                val categories = listOf("全部", "产品", "服务", "教程", "工具")
                LazyRow(
                    horizontalArrangement = Arrangement.spacedBy(8.dp)
                ) {
                    items(categories) { category ->
                        FilterChip(
                            onClick = { selectedCategory = category },
                            label = { Text(category) },
                            selected = selectedCategory == category
                        )
                    }
                }
            }
        }

        // 搜索结果信息
        if (searchQuery.isNotEmpty() || selectedCategory != "全部") {
            Text(
                text = "找到 ${filteredItems.size} 个结果",
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.primary,
                modifier = Modifier.padding(horizontal = 16.dp, vertical = 8.dp)
            )
        }

        // 搜索结果列表
        if (filteredItems.isEmpty()) {
            Box(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(16.dp),
                contentAlignment = Alignment.Center
            ) {
                Column(
                    horizontalAlignment = Alignment.CenterHorizontally
                ) {
                    Icon(
                        imageVector = Icons.Default.SearchOff,
                        contentDescription = null,
                        modifier = Modifier.size(64.dp),
                        tint = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                    Spacer(modifier = Modifier.height(16.dp))
                    Text(
                        text = "没有找到相关内容",
                        style = MaterialTheme.typography.titleMedium,
                        color = MaterialTheme.colorScheme.onSurfaceVariant
                    )
                }
            }
        } else {
            LazyColumn(
                modifier = Modifier.weight(1f),
                contentPadding = PaddingValues(16.dp),
                verticalArrangement = Arrangement.spacedBy(8.dp)
            ) {
                items(filteredItems) { item ->
                    SearchableListItem(item = item)
                }
            }
        }
    }
}

@OptIn(ExperimentalMaterial3Api::class)
@Composable
private fun SearchableListItem(item: SearchableItem) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .clickable { /* 处理点击 */ },
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Row(
            modifier = Modifier.padding(16.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            Surface(
                modifier = Modifier.size(48.dp),
                color = MaterialTheme.colorScheme.primaryContainer,
                shape = MaterialTheme.shapes.medium
            ) {
                Box(contentAlignment = Alignment.Center) {
                    Icon(
                        imageVector = item.icon,
                        contentDescription = null,
                        modifier = Modifier.size(24.dp),
                        tint = MaterialTheme.colorScheme.primary
                    )
                }
            }
            Spacer(modifier = Modifier.width(12.dp))
            Column(modifier = Modifier.weight(1f)) {
                Text(
                    text = item.title,
                    style = MaterialTheme.typography.titleMedium
                )
                Text(
                    text = item.description,
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant,
                    maxLines = 2
                )
                Spacer(modifier = Modifier.height(4.dp))
                Surface(
                    color = MaterialTheme.colorScheme.secondaryContainer,
                    shape = MaterialTheme.shapes.small
                ) {
                    Text(
                        text = item.category,
                        style = MaterialTheme.typography.labelSmall,
                        color = MaterialTheme.colorScheme.onSecondaryContainer,
                        modifier = Modifier.padding(horizontal = 8.dp, vertical = 2.dp)
                    )
                }
            }
            Icon(
                imageVector = Icons.Default.KeyboardArrowRight,
                contentDescription = "详情",
                tint = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
}
```

---

## 5. 性能优化技巧

### 5.1 自定义键值

```kotlin
@Composable
fun OptimizedListExample() {
    // 使用稳定的键值来优化重组
    val items = generateStableItems()

    LazyColumn(
        modifier = Modifier.fillMaxSize(),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        items(
            items = items,
            key = { item -> item.id } // 使用唯一ID作为键值
        ) { item ->
            OptimizedListItem(item = item)
        }
    }
}

@Composable
private fun OptimizedListItem(item: StableItem) {
    // 使用 remember 避免不必要的重组
    val formattedTime = remember(item.timestamp) {
        SimpleDateFormat("yyyy-MM-dd HH:mm", Locale.getDefault())
            .format(Date(item.timestamp))
    }

    Card(
        modifier = Modifier
            .fillMaxWidth()
            .animateItemPlacement() // 添加动画效果
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween
            ) {
                Text(
                    text = item.title,
                    style = MaterialTheme.typography.titleMedium
                )
                Text(
                    text = formattedTime,
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
            Text(
                text = item.content,
                style = MaterialTheme.typography.bodyMedium,
                modifier = Modifier.padding(top = 4.dp)
            )
        }
    }
}
```

### 5.2 分页加载

```kotlin
@Composable
fun PaginatedListExample() {
    var items by remember { mutableStateOf<List<PaginatedItem>>(emptyList()) }
    var isLoading by remember { mutableStateOf(false) }
    var hasMore by remember { mutableStateOf(true) }
    val listState = rememberLazyListState()

    // 加载更多数据的函数
    val loadMoreItems = {
        if (!isLoading && hasMore) {
            isLoading = true
            // 模拟网络请求
            LaunchedEffect(Unit) {
                delay(1000) // 模拟网络延迟
                val newItems = generatePaginatedItems(items.size)
                items = items + newItems
                isLoading = false
                hasMore = newItems.size == 20 // 假设每页20条
            }
        }
    }

    // 初始加载
    LaunchedEffect(Unit) {
        loadMoreItems()
    }

    // 监听滚动到底部
    LaunchedEffect(listState) {
        snapshotFlow { listState.layoutInfo.visibleItemsInfo.lastOrNull()?.index }
            .collect { lastVisibleIndex ->
                if (lastVisibleIndex != null && lastVisibleIndex >= items.size - 3) {
                    loadMoreItems()
                }
            }
    }

    LazyColumn(
        state = listState,
        modifier = Modifier.fillMaxSize(),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(8.dp)
    ) {
        items(items) { item ->
            PaginatedListItem(item = item)
        }

        // 加载指示器
        if (isLoading) {
            item {
                Box(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(16.dp),
                    contentAlignment = Alignment.Center
                ) {
                    CircularProgressIndicator()
                }
            }
        }

        // 没有更多数据提示
        if (!isLoading && !hasMore && items.isNotEmpty()) {
            item {
                Text(
                    text = "没有更多数据了",
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant,
                    textAlign = TextAlign.Center,
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(16.dp)
                )
            }
        }
    }
}

@Composable
private fun PaginatedListItem(item: PaginatedItem) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .animateItemPlacement()
    ) {
        Row(
            modifier = Modifier.padding(16.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            Surface(
                modifier = Modifier.size(40.dp),
                color = MaterialTheme.colorScheme.primaryContainer,
                shape = CircleShape
            ) {
                Box(contentAlignment = Alignment.Center) {
                    Text(
                        text = "${item.id}",
                        style = MaterialTheme.typography.titleSmall,
                        color = MaterialTheme.colorScheme.onPrimaryContainer
                    )
                }
            }
            Spacer(modifier = Modifier.width(12.dp))
            Column(modifier = Modifier.weight(1f)) {
                Text(
                    text = "项目 ${item.id}",
                    style = MaterialTheme.typography.titleMedium
                )
                Text(
                    text = "这是第 ${item.id} 个项目的描述信息",
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
        }
    }
}
```

---

## 6. 数据类定义

```kotlin
// 用户数据类
data class User(
    val name: String,
    val role: String,
    val email: String,
    val phone: String,
    val description: String
)

// 产品数据类
data class Product(
    val name: String,
    val description: String,
    val price: Int,
    val icon: ImageVector
)

// 混合列表数据
data class MixedListData(
    val users: List<User>,
    val products: List<Product>
)

// 图片项数据类
data class ImageItem(
    val id: Int,
    val title: String,
    val description: String
)

// 网格项数据类
data class GridItem(
    val title: String,
    val icon: ImageVector
)

// 可变网格项类型
enum class GridItemType { SMALL, MEDIUM, LARGE }

data class VariableGridItem(
    val title: String,
    val description: String,
    val icon: ImageVector,
    val type: GridItemType
)

// 可搜索项数据类
data class SearchableItem(
    val id: Int,
    val title: String,
    val description: String,
    val category: String,
    val icon: ImageVector
)

// 稳定项数据类
data class StableItem(
    val id: String,
    val title: String,
    val content: String,
    val timestamp: Long
)

// 分页项数据类
data class PaginatedItem(
    val id: Int
)

// 生成数据的辅助函数
private fun generateMixedListData() = MixedListData(
    users = generatePersonList(),
    products = generateProductList()
)

private fun generateGridItems() = listOf(
    GridItem("编程", Icons.Default.Code),
    GridItem("设计", Icons.Default.Palette),
    GridItem("音乐", Icons.Default.MusicNote),
    GridItem("照片", Icons.Default.Photo),
    GridItem("视频", Icons.Default.VideoFile),
    GridItem("文档", Icons.Default.Description),
    GridItem("设置", Icons.Default.Settings),
    GridItem("帮助", Icons.Default.Help)
)

private fun generateVariableGridItems() = listOf(
    VariableGridItem("小项目", "小尺寸网格项", Icons.Default.Star, GridItemType.SMALL),
    VariableGridItem("中项目", "中等尺寸网格项", Icons.Default.Widgets, GridItemType.MEDIUM),
    VariableGridItem("大项目", "大尺寸网格项", Icons.Default.Dashboard, GridItemType.LARGE),
    VariableGridItem("小项目2", "另一个小项目", Icons.Default.Favorite, GridItemType.SMALL),
    VariableGridItem("中项目2", "另一个中等项目", Icons.Default.Notifications, GridItemType.MEDIUM)
)

private fun generateSearchableItems() = listOf(
    SearchableItem(1, "Android 开发", "Kotlin 和 Jetpack Compose 开发", "产品", Icons.Default.Phone),
    SearchableItem(2, "UI 设计", "Material Design 界面设计", "服务", Icons.Default.Palette),
    SearchableItem(3, "Compose 教程", "Jetpack Compose 入门教程", "教程", Icons.Default.School),
    SearchableItem(4, "开发工具", "Android Studio 和相关插件", "工具", Icons.Default.Build),
    SearchableItem(5, "移动应用", "iOS 和 Android 应用开发", "产品", Icons.Default.Smartphone),
    SearchableItem(6, "用户体验", "UX 设计和用户研究", "服务", Icons.Default.Person)
)

private fun generateStableItems() = (1..20).map {
    StableItem(
        id = "item_$it",
        title = "标题 $it",
        content = "这是第 $it 个项目的内容描述，包含了详细的文本信息。",
        timestamp = System.currentTimeMillis() - it * 1000L
    )
}

private fun generatePaginatedItems(startIndex: Int): List<PaginatedItem> {
    return if (startIndex < 100) { // 模拟总共100条数据
        (startIndex + 1..minOf(startIndex + 20, 100)).map { PaginatedItem(it) }
    } else {
        emptyList()
    }
}
```

---

## 7. 最佳实践

### 7.1 性能优化

1. **使用稳定的键值**：为 items 提供唯一的、稳定的 key
2. **避免复杂计算**：在列表项组件中避免耗时计算
3. **使用 remember 缓存**：缓存计算结果避免重复计算
4. **合理使用 derivedStateOf**：当状态依赖其他状态时使用

### 7.2 用户体验

1. **提供加载状态**：在数据加载时显示进度指示器
2. **支持搜索过滤**：提供搜索和过滤功能
3. **添加动画效果**：使用 animateItemPlacement 增强体验
4. **空状态处理**：当没有数据时提供友好的空状态界面

### 7.3 无障碍性

1. **添加内容描述**：为图片和图标添加 contentDescription
2. **支持键盘导航**：确保列表项可以通过键盘选择
3. **语义化标记**：使用适当的语义化组件

---

## 8. 总结

Jetpack Compose 的列表组件提供了强大而灵活的数据展示能力：

1. **LazyColumn**：高效的垂直滚动列表
2. **LazyRow**：水平滚动列表，适合横向内容
3. **LazyVerticalGrid**：网格布局，支持自适应和固定列数
4. **状态管理**：支持滚动状态监控和程序化滚动
5. **性能优化**：懒加载机制和重组优化
6. **交互功能**：搜索、过滤、分页等高级功能

通过合理使用这些组件和技术，你可以构建性能优异、用户体验出色的列表界面。

在下一篇文章中，我们将探讨图像组件，学习如何在 Compose 中处理和展示图像内容。

---

## 相关资源

- [Compose Lists Documentation](https://developer.android.com/jetpack/compose/lists)
- [LazyRow and LazyColumn Documentation](https://developer.android.com/jetpack/compose/lists/lazy-row-and-lazy-column)
- [LazyVerticalGrid Documentation](https://developer.android.com/jetpack/compose/lists/lazypverticalgrid)

---

*本文基于 Android Jetpack Compose 最新版本编写，部分 API 可能会随着版本更新而变化。*